<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Qiana">





<title>前端工程化2-脚手架工具 | Qiana前端小栈</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    
    <script src="/js/jquery.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.1.1"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="/">Qiana&#39;s Blog</a>
            </div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">文档</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                    <label for="switch_default" class="toggleBtn"></label>
                </div>
            </div>
        </nav>

        
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="/">Qiana&#39;s Blog</a>
                        <a id="mobile-toggle-theme">·&nbsp;Light</a>
                    </div>
                    <div class="menu-toggle" onclick="mobileBtn()">&#9776;</div>
                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/archives">文档</a>
                    
                        <a class="menu-item" href="/category">分类</a>
                    
                        <a class="menu-item" href="/tag">标签</a>
                    
                        <a class="menu-item" href="/about">关于</a>
                    
                </div>
            </div>
        </nav>

    </header>
    <script>
        var mobileBtn = function f() {
            var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
            var mobileMenu = document.getElementById("mobile-menu");
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }
    </script>

        <div class="main">
            <div
    class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">前端工程化2-脚手架工具</h1>
            
                <div class="post-meta">
                    
                        作者:
                        <a itemprop="author" rel="author" href="/">Qiana</a>&nbsp;&nbsp;
                    

                    
                        <span class="post-time">
                            日期:
                            <a href="#">2020-12-04</a>&nbsp;&nbsp;
                        </span>
                    
                    
                        <span class="post-category">
                            分类:
                            
                                <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">前端工程化</a>&nbsp;&nbsp;
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="脚手架概念"><a href="#脚手架概念" class="headerlink" title="脚手架概念"></a>脚手架概念</h1><blockquote>
<p>自动帮我们创建项目基础文件的工具。</p>
</blockquote>
<p>脚手架的本质作用：创建项目基础结构、提供项目规范和约定。</p>
<h1 id="常用的脚手架工具"><a href="#常用的脚手架工具" class="headerlink" title="常用的脚手架工具"></a>常用的脚手架工具</h1><p>目前市场上有很多成熟的脚手架工具。</p>
<p><strong>为特定的项目类型服务的脚手架</strong>：其实现方式都是通过提供一下项目信息，脚手架根据信息创建对应的项目基础结构。只适用于自己所服务的那个项目。</p>
<ul>
<li><p>React项目：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/getting-started/">create-react-app</a></p>
</li>
<li><p>Vue项目：<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/">@vue/cli</a>, <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-cli/tree/v2#vue-cli--">vue-cli</a></p>
</li>
<li><p>Angular项目：<a target="_blank" rel="noopener" href="https://cli.angular.io/">angular-cli</a></p>
</li>
</ul>
<p><strong>通用型项目脚手架工具</strong>：</p>
<p><a target="_blank" rel="noopener" href="https://yeoman.io/">Yeoman</a>, 可以根据一套模板生成对应的项目结构。</p>
<p><a target="_blank" rel="noopener" href="https://plopjs.com/">Plop</a>, 用于创建特定类型文件,小而美的脚手架工具</p>
<h2 id="Yeoman"><a href="#Yeoman" class="headerlink" title="Yeoman"></a>Yeoman</h2><blockquote>
<p>用于创建现代化Web应用的脚手架工具</p>
</blockquote>
<p>可以通过Yeoman创建Generator创建任何类型的项目，即我么可以通过创建自己的Generator来创建自己的脚手架。</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><blockquote>
<p> 需要node环境的支持。</p>
</blockquote>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><strong>安装yeoman</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add yo </span><br></pre></td></tr></table></figure>

<p><strong>安装对应generator</strong>  (比如想要生成一个node模块的项目，需要安装<code>generator-node</code>)</p>
<p>Generators 是一个名字为 <code>generator-XXX</code> 的 npm 包。</p>
<p><a target="_blank" rel="noopener" href="https://yeoman.io/generators/">Generators  列表</a>,或者可以使用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add generator<span class="literal">-node</span></span><br></pre></td></tr></table></figure>

<h4 id="创建项目目录"><a href="#创建项目目录" class="headerlink" title="创建项目目录"></a>创建项目目录</h4><p>比如创建<code>yeoman-node-module</code>目录</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir yeoman<span class="literal">-node</span><span class="literal">-module</span></span><br></pre></td></tr></table></figure>

<h4 id="运行generator创建项目"><a href="#运行generator创建项目" class="headerlink" title="运行generator创建项目"></a>运行generator创建项目</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo node</span><br></pre></td></tr></table></figure>

<p><em>根据命令行信息提示，输入相关信息</em></p>
<h4 id="Yeoman-Sub-Generator"><a href="#Yeoman-Sub-Generator" class="headerlink" title="Yeoman Sub Generator"></a>Yeoman Sub Generator</h4><blockquote>
<p>在已有的项目基础之上添加特定文件。</p>
</blockquote>
<p>比如通过generator-node下的cli sub generator生成一个cli应用所需要的文件。<code>yo &lt;generator&gt;:&lt;sub-generator&gt;</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo node:<span class="built_in">cli</span></span><br></pre></td></tr></table></figure>

<p>项目中package.json中添加了</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;bin&quot;: &quot;lib/cli.js&quot;,</span><br><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">  &quot;meow&quot;: &quot;^3.7.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>并创建了<code>lib/cli.js</code>文件</p>
<p>此时，我们就可以将我们的模块作为一个全局的命令行模块去使用了。</p>
<h4 id="将本地模块link到全局范围"><a href="#将本地模块link到全局范围" class="headerlink" title="将本地模块link到全局范围"></a>将本地模块link到全局范围</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn link</span><br></pre></td></tr></table></figure>

<p>安装项目依赖后，我们就可以通过模块名称来运行我们生产的模块了</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yeoman<span class="literal">-node</span><span class="literal">-module</span> -<span class="literal">-help</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>若发生了权限相关问题的报错，可以使用<code>chmod 755 &lt;filemane&gt;</code>来修改文件权限。</p>
<p><a href="/2020/12/06/other/shell/chmod/">chmod修改权限命令</a></p>
</blockquote>
<blockquote>
<p>若使用yarn发生command not found的错误，需要确认命令是否正确，或需要<a target="_blank" rel="noopener" href="https://yarn.bootcss.com/docs/install/#mac-stable">添加 yarn 到 PATH 环境变量中</a>。</p>
</blockquote>
<h3 id="步骤总结"><a href="#步骤总结" class="headerlink" title="步骤总结"></a>步骤总结</h3><ol>
<li>明确需求—要做一个什么类型的项目</li>
<li>找到合适的Generator</li>
<li>全局范围安装找到的Generator</li>
<li>通过<code>yo</code>运行对应的Generator</li>
<li>通过命令行交互填写选项信息</li>
<li>生成需要的项目结构</li>
</ol>
<h4 id="例子：webapp"><a href="#例子：webapp" class="headerlink" title="例子：webapp"></a>例子：webapp</h4><ol>
<li>需求，开发一款webapp</li>
<li>合适的Generator–generator-webapp</li>
<li>全局范围安装Generator–<code>yarn global add generator-webapp</code></li>
<li>运行Generator – <code>yo webapp</code></li>
</ol>
<h2 id="Plop"><a href="#Plop" class="headerlink" title="Plop"></a>Plop</h2><blockquote>
<p>小型脚手架工具，用于创建项目中特定类型文件的小工具。</p>
<p>一般不会独立去使用，一般将Plop集成到项目中，用于自动生成同类型的项目文件。</p>
</blockquote>
<p>解决的痛点：</p>
<p>比如在开发中，每个组件由js、css、test.js三个文件组成，那我们每次创建一个组件就需要手动创建三个文件，并且需要在文件中重复写入一些基础代码。</p>
<h3 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>将plop作为一个基本模块安装到开发依赖中</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add plop -<span class="literal">-dev</span></span><br></pre></td></tr></table></figure>

<h4 id="创建plop生成器"><a href="#创建plop生成器" class="headerlink" title="创建plop生成器"></a>创建plop生成器</h4><ol>
<li><p><strong>在项目根目录下创建<code>plopfile.js</code>—plop工作的入口文件</strong></p>
<p><code>plopfile.js</code>需要接收一个plop对象，用于创建生成器任务</p>
<p>使用<code>module.exports</code>导出一个函数，使<code>plop</code>接收一个形式参数，</p>
<p>plop.setGenerator接收两个参数：Generator名称，生成器的配置选项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//plopfile.js</span></span><br><span class="line"><span class="built_in">module</span>.export = <span class="function"><span class="params">plop</span>=&gt;</span>&#123;</span><br><span class="line">  plop.setGenerator(<span class="string">&#x27;component&#x27;</span>,&#123;</span><br><span class="line">    <span class="comment">//描述</span></span><br><span class="line">    description:<span class="string">&quot;create a component&quot;</span>,</span><br><span class="line">    <span class="comment">//命令行交互</span></span><br><span class="line">    prompts:[</span><br><span class="line">      &#123;</span><br><span class="line">        type:<span class="string">&quot;input&quot;</span>,</span><br><span class="line">        name:<span class="string">&quot;name&quot;</span>,</span><br><span class="line">        message:<span class="string">&quot;component name&quot;</span>,<span class="comment">//提示</span></span><br><span class="line">        <span class="keyword">default</span>:<span class="string">&quot;Mycomponent&quot;</span><span class="comment">//默认值</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//创建完成后执行动作对象</span></span><br><span class="line">    actions:[</span><br><span class="line">      &#123;</span><br><span class="line">        type:<span class="string">&quot;add&quot;</span>,<span class="comment">//添加一个全新的文件</span></span><br><span class="line">        path:<span class="string">&quot;src/components/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.js&quot;</span>,<span class="comment">//name即命令行交互中输入的name值</span></span><br><span class="line">        templateFile:<span class="string">&quot;plop-templates/components.hbs&quot;</span></span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        type:<span class="string">&quot;add&quot;</span>,<span class="comment">//添加一个全新的文件</span></span><br><span class="line">        path:<span class="string">&quot;src/components/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.css&quot;</span>,<span class="comment">//name即命令行交互中输入的name值</span></span><br><span class="line">        templateFile:<span class="string">&quot;plop-templates/components.css.hbs&quot;</span></span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        type:<span class="string">&quot;add&quot;</span>,<span class="comment">//添加一个全新的文件</span></span><br><span class="line">        path:<span class="string">&quot;src/components/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.test.js&quot;</span>,<span class="comment">//name即命令行交互中输入的name值</span></span><br><span class="line">        templateFile:<span class="string">&quot;plop-templates/components.test.hbs&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加模板文件</strong></p>
<p>模板文件使用<code>handlebars</code>语法书写。<a target="_blank" rel="noopener" href="https://handlebarsjs.com/zh/">官网看这里</a>, <a href="/2020/12/06/utility-library/Handlebars/handlebars/">我的笔记看这里</a></p>
</li>
</ol>
<h4 id="使用plop-generator"><a href="#使用plop-generator" class="headerlink" title="使用plop generator"></a>使用plop generator</h4><p>因为在安装plop模块的时候，plop提供了一个cli程序，所以可以通过yarn来找到plop命令。</p>
<p><code>yarn plop &lt;generator-name&gt;</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn plop component</span><br></pre></td></tr></table></figure>

<h3 id="步骤总结-1"><a href="#步骤总结-1" class="headerlink" title="步骤总结"></a>步骤总结</h3><ol>
<li>将plop模块作为项目开发依赖安装</li>
<li>在项目根目录下创建<code>plopfile.js</code>作为plop入口文件</li>
<li>在<code>plopfile.js</code>文件中定义脚手架任务</li>
<li>编写用于生成特定类型文件的模板</li>
<li>通过plop提供的CLI运行脚手架任务</li>
</ol>
<h1 id="开发一款脚手架"><a href="#开发一款脚手架" class="headerlink" title="开发一款脚手架"></a>开发一款脚手架</h1><h2 id="使用Yeoman搭建自己的手脚架-—-自定义Generator"><a href="#使用Yeoman搭建自己的手脚架-—-自定义Generator" class="headerlink" title="使用Yeoman搭建自己的手脚架 — 自定义Generator"></a>使用Yeoman搭建自己的手脚架 — 自定义Generator</h2><h3 id="Generator名称"><a href="#Generator名称" class="headerlink" title="Generator名称"></a>Generator名称</h3><p>yeoman规定，Generator的名称必须是<code>generator-&lt;name&gt;</code>的形式</p>
<h3 id="Generator基础结构介绍"><a href="#Generator基础结构介绍" class="headerlink" title="Generator基础结构介绍"></a>Generator基础结构介绍</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|-generators/        # 生成器目录</span><br><span class="line">|   |-app/           # 默认生成器目录</span><br><span class="line">|		|  |-index.js    # 默认生成器实现</span><br><span class="line">|		|</span><br><span class="line">|		|-component      # 其他生成器目录（子生成器）</span><br><span class="line">|		   |-index.js    # 其他生成器实现</span><br><span class="line">|-package.json       # 模块包配置文件</span><br></pre></td></tr></table></figure>

<h3 id="实例：创建一个generator-sample的Generator"><a href="#实例：创建一个generator-sample的Generator" class="headerlink" title="实例：创建一个generator-sample的Generator"></a>实例：创建一个generator-sample的Generator</h3><h4 id="创建generator目录"><a href="#创建generator目录" class="headerlink" title="创建generator目录"></a>创建generator目录</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录并进入目录</span></span><br><span class="line">mkdir generator<span class="literal">-sample</span></span><br><span class="line"><span class="built_in">cd</span> generator<span class="literal">-sample</span></span><br><span class="line"><span class="comment"># 初始化 package.json</span></span><br><span class="line">yarn init</span><br></pre></td></tr></table></figure>

<h4 id="添加yeoman-generator模块"><a href="#添加yeoman-generator模块" class="headerlink" title="添加yeoman-generator模块"></a>添加yeoman-generator模块</h4><blockquote>
<p>yeoman-generator模块提供了生成器的一个基类，在这个基类中提供了一些工具函数，让我们在创建生成器的时候更加便捷。</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add yeoman<span class="literal">-generator</span></span><br></pre></td></tr></table></figure>

<h4 id="按照Generator结构要求，添加结构文件"><a href="#按照Generator结构要求，添加结构文件" class="headerlink" title="按照Generator结构要求，添加结构文件"></a>按照Generator结构要求，添加结构文件</h4><blockquote>
<p>generators/app/index.js 是Generator的核心入口。</p>
<p>需要导出一个继承自Yeoman Generator的类型。</p>
<p>Yeoman Gernerator在工作的时候会自动调用我们在此类型中定义的一些生命周期函数</p>
<p>我们在这些方法中可以通过调用父类提供的一些工具方法实现一些功能：如文件写入</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">const</span> Generator =<span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">  writing()&#123;</span><br><span class="line">    <span class="comment">//Yeoman自动在成文件时调用此方法</span></span><br><span class="line">    <span class="comment">//尝试</span></span><br><span class="line">    <span class="comment">//fs是不是node中原生的fs，是经过高度封装的fs模块</span></span><br><span class="line">    <span class="comment">//write接收两个参数：写入文件的绝对路径，写入文件的内容</span></span><br><span class="line">    <span class="built_in">this</span>.fs.write(</span><br><span class="line">      <span class="comment">//通过父类的destinationPath方法，自动获取生成项目目录路径</span></span><br><span class="line">      <span class="built_in">this</span>.destinationPath(<span class="string">&#x27;temp.txt&#x27;</span>),</span><br><span class="line">      <span class="comment">//内容用随机数代替。</span></span><br><span class="line">      <span class="built_in">Math</span>.random().toString()</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="将generator-link到全局，成为全局模块包"><a href="#将generator-link到全局，成为全局模块包" class="headerlink" title="将generator link到全局，成为全局模块包"></a>将generator link到全局，成为全局模块包</h4><blockquote>
<p>为了让Yeoman能够找到我们写的<code>generator-sample</code></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn link</span><br></pre></td></tr></table></figure>

<h4 id="使用自定义的generator"><a href="#使用自定义的generator" class="headerlink" title="使用自定义的generator"></a>使用自定义的generator</h4><ol>
<li>创建项目文件夹</li>
<li>在项目文件夹下执行<code>yo sample</code></li>
</ol>
<p>我们会发现，项目文件夹下有了<code>temp.txt</code>文件，并在文件内写入了随机数。</p>
<h3 id="实例改进1：通过模板文件创建文件"><a href="#实例改进1：通过模板文件创建文件" class="headerlink" title="实例改进1：通过模板文件创建文件"></a>实例改进1：通过模板文件创建文件</h3><blockquote>
<p>相对于手动创建每一个文件，模板的方式大大提高了效率</p>
</blockquote>
<p>在生成器目录下添加<code>templates</code>目录，在目录下创建模板文件。</p>
<p>模板文件内部可以使用EJS模板标记输出数据，例如<code>&lt;%= title %&gt;</code>,</p>
<p>也可以使用其他的EJS语法，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (success) &#123;%&gt;</span><br><span class="line">success text</span><br><span class="line">&lt;% &#125;%&gt;</span><br></pre></td></tr></table></figure>

<p>在生成文件时，就不用借助于<code>fs.write</code>方法去写入文件，可以使用fs中专门使用模版引擎的方法–<code>copyTpl</code></p>
<p><code>copyTpl</code>方法接收三个参数：模板文件路径、输出文件路径、模板数据上下文</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- templates/index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator =<span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">  writing()&#123;</span><br><span class="line">    <span class="comment">//模板文件路径  -- 模板文件路径</span></span><br><span class="line">    <span class="keyword">const</span> tmpl = <span class="built_in">this</span>.templatePath(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="comment">//输出目标路径  -- 通过父类的destinationPath方法，自动获取生成项目目录下对应的文件路径</span></span><br><span class="line">    <span class="keyword">const</span> outpur = <span class="built_in">this</span>.destinationPath(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="comment">//模板数据上下文</span></span><br><span class="line">    <span class="keyword">const</span> context = &#123; <span class="attr">title</span>:<span class="string">&quot;Hello sample generator&quot;</span>,<span class="attr">success</span>:<span class="literal">true</span> &#125;</span><br><span class="line">    <span class="comment">//copyTpl方法会自动将我们的模板文件映射到目标文件上</span></span><br><span class="line">    <span class="built_in">this</span>.fs.copyTpl(tmpl,outpur,context)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目文件夹下执行<code>yo sample</code>,会发现，创建了<code>index.html</code>文件，并自动将“Hello sample generator”填充到了<code>&lt;%= titlte %&gt;</code>位置</p>
<h3 id="实例改进2：接收用户输入数据"><a href="#实例改进2：接收用户输入数据" class="headerlink" title="实例改进2：接收用户输入数据"></a>实例改进2：接收用户输入数据</h3><blockquote>
<p>在Generator中，想要发起一个命令行交互的询问，可以通过实现Generator中的<code>prompting()</code>方法。</p>
</blockquote>
<p>在<code>prompting</code>方法中，可以通过调用父类提供的<code>prompt()</code>方法，发出对用户的询问。</p>
<p><code>prompt()</code>是一个Promise方法，返回一个Promise。在<code>prompting</code>中将<code>prompt</code>返回，Yeoman在工作中将会获得更好的异步流程控制。</p>
<p><code>prompt()</code>接收一个数组参数，数组中的每一项都是一个问题对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">prompting()&#123;</span><br><span class="line">  <span class="built_in">this</span>.prompt([</span><br><span class="line">    &#123;</span><br><span class="line">      type:<span class="string">&#x27;input&#x27;</span>, <span class="comment">// 输入方式</span></span><br><span class="line">      name:<span class="string">&#x27;prompt_name&#x27;</span>, <span class="comment">//最终得到结果的键</span></span><br><span class="line">      message:<span class="string">&quot;your project name&quot;</span>, <span class="comment">// 提示信息</span></span><br><span class="line">      <span class="keyword">default</span>: <span class="built_in">this</span>.appname <span class="comment">//appname为项目生成目录名称，问题的默认值。</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]).then(<span class="function"><span class="params">answers</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//用户输入结果，键为定义的prompt_name，值为用户输入的结果  &#123;prompt_name:&#x27;user input value&#x27;&#125;</span></span><br><span class="line">    <span class="comment">//将用户输入结果挂载到this对象上，方便后面使用</span></span><br><span class="line">    <span class="built_in">this</span>.answers = answers</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  prompting() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.prompt([&#123;</span><br><span class="line">      type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">      message: <span class="string">&quot;your project name&quot;</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="built_in">this</span>.appname</span><br><span class="line">    &#125;]).then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.answers = answers</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  writing() &#123; <span class="comment">// 模板文件路径  -- 模板文件路径</span></span><br><span class="line">    <span class="keyword">const</span> tmpl = <span class="built_in">this</span>.templatePath(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="comment">// 输出目标路径  -- 通过父类的destinationPath方法，自动获取生成项目目录下对应的文件路径</span></span><br><span class="line">    <span class="keyword">const</span> outpur = <span class="built_in">this</span>.destinationPath(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="comment">// 模板数据上下文</span></span><br><span class="line">    <span class="keyword">const</span> context = <span class="built_in">this</span>.answers</span><br><span class="line">    <span class="comment">// copyTpl方法会自动将我们的模板文件映射到目标文件上</span></span><br><span class="line">    <span class="built_in">this</span>.fs.copyTpl(tmpl, outpur, context)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行<code>yo sample</code>,要求输入title，执行完成后，发现<code>index.html</code>文件中，将输入的title内容填充到了<code>&lt;%= titlte %&gt;</code>位置</p>
<h3 id="实例改进3-创建一系列文件"><a href="#实例改进3-创建一系列文件" class="headerlink" title="实例改进3: 创建一系列文件"></a>实例改进3: 创建一系列文件</h3><p>在templates文件夹下，放置一些列模版文件，在index.js中，循环拷贝映射文件到目标文件上。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|<span class="literal">-tempaltes</span></span><br><span class="line">|   |<span class="literal">-README</span>.md</span><br><span class="line">|   |<span class="literal">-package</span>.json</span><br><span class="line">|   |<span class="literal">-src</span></span><br><span class="line">|   	 |<span class="literal">-index</span>.html</span><br></pre></td></tr></table></figure>

<p>简单的写下文件内容</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">README.md 文件</span><br><span class="line"><span class="section"># <span class="xml"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span></span></span></span><br><span class="line">命令行提供的项目名称将替代name值</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">%%=</span> <span class="attr">name</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">p</span>&gt;</span>命令行输入的title值将替换title<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>name行将输出EJS模板<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//packaje.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&lt;%= name %&gt;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;qiana-wei&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;yeoman-generator&quot;</span>: <span class="string">&quot;^4.12.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">//引入yeoman-generator模块</span></span><br><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"><span class="comment">//导出继承了generator的类</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  <span class="comment">//询问信息填写</span></span><br><span class="line">  prompting() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.prompt([&#123;</span><br><span class="line">      type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">      message: <span class="string">&quot;your web title&quot;</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="built_in">this</span>.appname</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">      message: <span class="string">&quot;your project name&quot;</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="built_in">this</span>.appname</span><br><span class="line">    &#125;]).then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.answers = answers</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  writing() &#123;</span><br><span class="line">    <span class="keyword">const</span> templates = [</span><br><span class="line">      <span class="string">&#x27;README.md&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;package.json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/index.html&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">    templates.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.fs.copyTpl(</span><br><span class="line">        <span class="built_in">this</span>.templatePath(item),</span><br><span class="line">        <span class="built_in">this</span>.destinationPath(item),</span><br><span class="line">        <span class="built_in">this</span>.answers</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模板相关问题"><a href="#模板相关问题" class="headerlink" title="模板相关问题"></a>模板相关问题</h3><ol>
<li>当需要原封不动的输出EJS模板标记时，将模板改为<code>&lt;%%= template info %&gt;</code>,输出文件的模板标记即为<code>&lt;%= template info%&gt;</code></li>
</ol>
<h3 id="发布Generator"><a href="#发布Generator" class="headerlink" title="发布Generator"></a>发布Generator</h3><blockquote>
<p>Generator实际为一个npm模块，发布Generator即发布一个npm模块</p>
</blockquote>
<p>将已写好Generator模块通过<code>npm publish</code>发布为一个公开模块即可。</p>
<ol>
<li>将源代码托管于一个开源的代码管理仓库</li>
<li>使用<code>npm publish</code>或<code>yarn publish</code>命令发布</li>
<li>若使用的是淘宝镜像，发布时需要指定为官方镜像</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn publish -<span class="literal">-registry</span>=https://registry.yarnpkg.com</span><br></pre></td></tr></table></figure>

<h1 id="脚手架的工作原理"><a href="#脚手架的工作原理" class="headerlink" title="脚手架的工作原理"></a>脚手架的工作原理</h1><blockquote>
<p>启动脚手架过后，通过询问相关信息，将回答的结果结合模板文件，生成项目结构</p>
</blockquote>
<p>脚手架工具即一个node cli应用，所以创建一个脚手架工具即创建一个node cli工具。</p>
<h2 id="实例：创建一个node-cli应用"><a href="#实例：创建一个node-cli应用" class="headerlink" title="实例：创建一个node cli应用"></a>实例：创建一个node cli应用</h2><ol>
<li><p>创建项目目录<code>sample-cli</code></p>
</li>
<li><p>通过<code>yarn init</code>创建<code>package.json</code>文件</p>
</li>
<li><p>修改<code>package.json</code>文件，添加<code>bin</code>属性，指定为<code>cli.js</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;sample-cli&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;bin&quot;</span>:<span class="string">&quot;cli.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加<code>cli.js</code></p>
<p>cli的入口文件必须有个特定的文件头<code>#!/usr/bin/env node</code>。</p>
<p>若系统为Luinx或MacOS的话，需要修改文件权限为755</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;cli working&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过<code>yarn link</code>将模块link到全局</p>
</li>
<li><p>在全局使用<code>sample-cli</code>命令，若console.log正常执行，则cli工具的基础已经可以正常工作了。</p>
</li>
<li><p>完善脚手架命令</p>
<p>脚手架工作过程：</p>
<ul>
<li>通过命令行交互询问用户问题</li>
<li>根据用户回答结果生成文件</li>
</ul>
<p>node中使用命令行交互需要使用<code>inquirer</code>模块，安装该模块。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add inquirer</span><br></pre></td></tr></table></figure>

<p><code>inquirer</code>模块通过<code>prompt</code>方法发起命令行询问</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cli.js</span></span><br><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>)</span><br><span class="line">inquirer.prompt([</span><br><span class="line">  &#123;</span><br><span class="line">    type:<span class="string">&quot;input&quot;</span>,</span><br><span class="line">    name:<span class="string">&quot;name&quot;</span>,</span><br><span class="line">    message:<span class="string">&quot;Project name&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">]).then(<span class="function"><span class="params">answers</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(answers)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板</p>
<p>创建<code>tenplates</code>目录，在目录下创建模板文件(可以使用EJS模板语法)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.html--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//style.css</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#cccccc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据模板文件创建目标文件</p>
<blockquote>
<p>通过<code>path.join</code> 获取tempaltes文件目录</p>
<p>通过node 的<code>process.cwd()</code>获取命令执行的文件目录</p>
<p>通过<code>fs.readdir</code>获取templates文件夹下的所有文件,<code>fs.writeFileSync()</code>方法写入文件</p>
<p>通过<code>ejs</code>模块的<code>ejs.renderFile()</code>方法，读取文件内容</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cli.js</span></span><br><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>)</span><br><span class="line">inquirer.prompt([</span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">&quot;input&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;Project name&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">]).then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//模板目录 </span></span><br><span class="line">  <span class="keyword">const</span> tempDir = path.join(__dirname, <span class="string">&#x27;templates&#x27;</span>)</span><br><span class="line">  <span class="comment">//目标目录</span></span><br><span class="line">  <span class="keyword">const</span> distDir = process.cwd()</span><br><span class="line"></span><br><span class="line">  <span class="comment">//将模板目录下为文件输出到目标目录</span></span><br><span class="line">  fs.readdir(tempDir, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    files.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//item是相对template的相对路径</span></span><br><span class="line">      ejs.renderFile(path.join(tempDir, item), answers, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">        <span class="comment">//写入文件</span></span><br><span class="line">        fs.writeFileSync(path.join(distDir, item), result)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





</li>
</ol>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
        </div>

        
        <section class="post-tags">
            <div>
                <span>
                    标签:</span>
                <span class="tag">
                    
                        
                            <a href="/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">#
                                前端工程化</a>
                        
                            <a href="/tags/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B7%A5%E5%85%B7/">#
                                脚手架工具</a>
                        
                    
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">后退
                </a>
                <span>·
                </span>
                <a href="/">首页</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/12/06/other/shell/chmod/">linux chmod 修改权限</a>
            
            
                <a class="next" rel="next" href="/2020/12/03/engineering/overview/">前端工程化1-概览</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Qiana | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
